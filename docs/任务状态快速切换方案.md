# ä»»åŠ¡çŠ¶æ€å¿«é€Ÿåˆ‡æ¢åŠŸèƒ½å®ç°æ–¹æ¡ˆ

## åŠŸèƒ½æ¦‚è¿°

åœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ç‚¹å‡»ä»»åŠ¡çš„çŠ¶æ€æ ‡ç­¾ï¼Œé€šè¿‡ä¸‹æ‹‰èœå•å¿«é€Ÿåˆ‡æ¢ä»»åŠ¡çŠ¶æ€ï¼Œæ— éœ€è¿›å…¥ä»»åŠ¡è¯¦æƒ…é¡µé¢ã€‚

## åŠŸèƒ½ç‰¹æ€§

- âœ… ç‚¹å‡»çŠ¶æ€æ ‡ç­¾å¼¹å‡ºä¸‹æ‹‰èœå•
- âœ… æ˜¾ç¤ºæ‰€æœ‰å¯é€‰çŠ¶æ€ï¼ˆå¾…åŠã€è¿›è¡Œä¸­ã€å®¡æ ¸ä¸­ã€å·²å®Œæˆï¼‰
- âœ… æ¯ä¸ªçŠ¶æ€æœ‰å¯¹åº”çš„é¢œè‰²å’Œå›¾æ ‡
- âœ… ä½¿ç”¨ React Portal æ¸²æŸ“ä¸‹æ‹‰èœå•ï¼Œé¿å…è¢«çˆ¶å…ƒç´ è£å‰ª
- âœ… ç‚¹å‡»å¤–éƒ¨è‡ªåŠ¨å…³é—­èœå•
- âœ… æ”¯æŒæ·±è‰²æ¨¡å¼
- âœ… æµç•…çš„åŠ¨ç”»æ•ˆæœ

---

## æ–‡ä»¶ç»“æ„

```
frontend/src/components/
â”œâ”€â”€ TaskList.tsx      # ä»»åŠ¡åˆ—è¡¨ç»„ä»¶
â””â”€â”€ TaskList.css      # æ ·å¼æ–‡ä»¶
```

---

## TaskList.tsx å®Œæ•´ä»£ç 

```tsx
/**
 * ä»»åŠ¡åˆ—è¡¨ç»„ä»¶ - æ”¯æŒçŠ¶æ€å¿«é€Ÿåˆ‡æ¢
 */
import { useState, useMemo, useRef, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { Task } from '../services/task';
import { ChevronRight, ChevronDown, Check } from 'lucide-react';
import './TaskList.css';

interface TaskListProps {
  tasks: Task[];
  onTaskClick: (task: Task) => void;
  onStatusChange: (taskId: string, newStatus: string) => void;
}

// ============================================
// çŠ¶æ€é…ç½®
// ============================================
const STATUS_CONFIG: Record<string, { label: string; color: string }> = {
  todo: { label: 'å¾…åŠ', color: '#9ca3af' },
  in_progress: { label: 'è¿›è¡Œä¸­', color: '#3b82f6' },
  review: { label: 'å®¡æ ¸ä¸­', color: '#f59e0b' },
  done: { label: 'å·²å®Œæˆ', color: '#22c55e' },
};

const PRIORITY_CONFIG: Record<string, { label: string; color: string }> = {
  urgent: { label: 'ç´§æ€¥', color: '#ef4444' },
  high: { label: 'é«˜', color: '#f97316' },
  medium: { label: 'ä¸­', color: '#3b82f6' },
  low: { label: 'ä½', color: '#9ca3af' },
};

const STATUS_ORDER = ['todo', 'in_progress', 'review', 'done'];

// ============================================
// å­ä»»åŠ¡åŒ¹é…é€»è¾‘
// ============================================
function matchSubtaskToMain(subtaskTitle: string, mainTaskTitle: string): boolean {
  const cleanSubtask = subtaskTitle.replace('[å­ä»»åŠ¡]', '').toLowerCase().trim();
  const cleanMain = mainTaskTitle.toLowerCase();
  
  // å…³é”®è¯åŒ¹é…
  if (cleanMain.includes('æ¶æ„') && (cleanSubtask.includes('æ¶æ„') || cleanSubtask.includes('è®¾è®¡') || cleanSubtask.includes('æ¨¡å—') || cleanSubtask.includes('æŠ€æœ¯æ ˆ'))) {
    return true;
  }
  if (cleanMain.includes('æµ‹è¯•') && (cleanSubtask.includes('æµ‹è¯•') || cleanSubtask.includes('ç¯å¢ƒ'))) {
    return true;
  }
  if (cleanMain.includes('å¼€å‘') && (cleanSubtask.includes('å¼€å‘') || cleanSubtask.includes('å®ç°') || cleanSubtask.includes('ç¼–ç '))) {
    return true;
  }
  if (cleanMain.includes('è®¡åˆ’') && (cleanSubtask.includes('è®¡åˆ’') || cleanSubtask.includes('æ’æœŸ') || cleanSubtask.includes('å®‰æ’'))) {
    return true;
  }
  
  return false;
}

// ============================================
// ä¸»ç»„ä»¶
// ============================================
export default function TaskList({ tasks, onTaskClick, onStatusChange }: TaskListProps) {
  const [expandedTasks, setExpandedTasks] = useState<Set<string>>(new Set());
  const [openMenuId, setOpenMenuId] = useState<string | null>(null);
  const [menuPosition, setMenuPosition] = useState<{ top: number; left: number } | null>(null);
  const menuRef = useRef<HTMLDivElement>(null);

  // ============================================
  // ç‚¹å‡»å¤–éƒ¨å…³é—­èœå•
  // ============================================
  useEffect(() => {
    if (!openMenuId) return;
    
    const handleClickOutside = (e: MouseEvent) => {
      const target = e.target as HTMLElement;
      // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨çŠ¶æ€æŒ‰é’®ä¸Šï¼ˆè¿™ç§æƒ…å†µç”±æŒ‰é’®è‡ªå·±å¤„ç†ï¼‰
      if (target.closest('.status-btn')) return;
      // æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨ä¸‹æ‹‰èœå•å†…éƒ¨
      if (target.closest('.status-dropdown-portal')) return;
      
      setOpenMenuId(null);
      setMenuPosition(null);
    };
    
    // ä½¿ç”¨ setTimeout å»¶è¿Ÿæ·»åŠ ç›‘å¬å™¨ï¼Œé¿å…å½“å‰ç‚¹å‡»äº‹ä»¶è§¦å‘å…³é—­
    const timer = setTimeout(() => {
      document.addEventListener('click', handleClickOutside);
    }, 0);
    
    return () => {
      clearTimeout(timer);
      document.removeEventListener('click', handleClickOutside);
    };
  }, [openMenuId]);

  // ============================================
  // åˆ†ç»„ä»»åŠ¡ï¼ˆä¸»ä»»åŠ¡ + å­ä»»åŠ¡ï¼‰
  // ============================================
  const { mainTasks, subtasksByMain } = useMemo(() => {
    const mainTasks: Task[] = [];
    const allSubtasks: Task[] = [];
    const subtasksByMain: Record<string, Task[]> = {};

    // åˆ†ç±»
    tasks.forEach(task => {
      if (task.title.startsWith('[å­ä»»åŠ¡]') || task.parentId) {
        allSubtasks.push(task);
      } else {
        mainTasks.push(task);
      }
    });

    // æ’åºä¸»ä»»åŠ¡
    mainTasks.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());

    // å°†å­ä»»åŠ¡å…³è”åˆ°ä¸»ä»»åŠ¡
    mainTasks.forEach(main => {
      subtasksByMain[main.id] = [];
    });

    allSubtasks.forEach(sub => {
      // å¦‚æœæœ‰æ˜ç¡®çš„ parentId
      if (sub.parentId && subtasksByMain[sub.parentId]) {
        subtasksByMain[sub.parentId].push(sub);
      } else {
        // æ ¹æ®åç§°åŒ¹é…
        let matched = false;
        for (const main of mainTasks) {
          if (matchSubtaskToMain(sub.title, main.title)) {
            subtasksByMain[main.id].push(sub);
            matched = true;
            break;
          }
        }
        // å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œæ”¾åˆ°ç¬¬ä¸€ä¸ªä¸»ä»»åŠ¡ä¸‹
        if (!matched && mainTasks.length > 0) {
          subtasksByMain[mainTasks[0].id].push(sub);
        }
      }
    });

    // å¯¹æ¯ä¸ªä¸»ä»»åŠ¡çš„å­ä»»åŠ¡æ’åº
    Object.values(subtasksByMain).forEach(subs => {
      subs.sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());
    });

    return { mainTasks, subtasksByMain };
  }, [tasks]);

  // ============================================
  // å±•å¼€/æŠ˜å å­ä»»åŠ¡
  // ============================================
  const toggleExpand = (taskId: string) => {
    setExpandedTasks(prev => {
      const newSet = new Set(prev);
      if (newSet.has(taskId)) {
        newSet.delete(taskId);
      } else {
        newSet.add(taskId);
      }
      return newSet;
    });
  };

  // ============================================
  // çŠ¶æ€èœå•ç‚¹å‡»å¤„ç†
  // ============================================
  const handleStatusClick = (taskId: string, e: React.MouseEvent) => {
    e.stopPropagation();
    if (openMenuId === taskId) {
      setOpenMenuId(null);
      setMenuPosition(null);
    } else {
      const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();
      setMenuPosition({ top: rect.bottom + 4, left: rect.left });
      setOpenMenuId(taskId);
    }
  };

  // ============================================
  // çŠ¶æ€é€‰æ‹©å¤„ç†
  // ============================================
  const handleStatusSelect = (taskId: string, newStatus: string) => {
    onStatusChange(taskId, newStatus);
    setOpenMenuId(null);
    setMenuPosition(null);
  };

  // ============================================
  // æ—¥æœŸæ ¼å¼åŒ–
  // ============================================
  const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    const now = new Date();
    const diffDays = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60 * 24));
    if (diffDays === 0) return 'ä»Šå¤©';
    if (diffDays === 1) return 'æ˜¨å¤©';
    if (diffDays < 7) return `${diffDays}å¤©å‰`;
    return date.toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' });
  };

  // ============================================
  // æ¸²æŸ“çŠ¶æ€å›¾æ ‡
  // ============================================
  const renderStatusIcon = (status: string, size: number = 16) => {
    const color = STATUS_CONFIG[status]?.color || '#9ca3af';
    
    if (status === 'done') {
      return (
        <div className="status-icon done" style={{ borderColor: color, backgroundColor: color }}>
          <Check size={size * 0.65} strokeWidth={3} color="white" />
        </div>
      );
    }
    if (status === 'in_progress') {
      return (
        <div className="status-icon in-progress" style={{ borderColor: color }}>
          <div className="dot" style={{ backgroundColor: color }} />
        </div>
      );
    }
    if (status === 'review') {
      return (
        <div className="status-icon review" style={{ borderColor: color }}>
          <div className="ring" style={{ borderColor: color }} />
        </div>
      );
    }
    // todo
    return <div className="status-icon todo" />;
  };

  // ============================================
  // æ¸²æŸ“ä»»åŠ¡è¡Œ
  // ============================================
  const renderTaskRow = (task: Task, isSubtask: boolean = false) => {
    const hasSubtasks = !isSubtask && (subtasksByMain[task.id]?.length || 0) > 0;
    const isExpanded = expandedTasks.has(task.id);
    const subtaskCount = subtasksByMain[task.id]?.length || 0;
    const isTitleSubtask = task.title.startsWith('[å­ä»»åŠ¡]');
    const displayTitle = isTitleSubtask ? task.title.replace('[å­ä»»åŠ¡] ', '').replace('[å­ä»»åŠ¡]', '') : task.title;
    const priorityColor = PRIORITY_CONFIG[task.priority]?.color || '#9ca3af';
    const isMenuOpen = openMenuId === task.id;

    return (
      <div key={task.id} className="task-item-container">
        <div 
          className={`task-item ${task.status === 'done' ? 'completed' : ''} ${isSubtask ? 'is-subtask' : ''}`}
          onClick={() => onTaskClick(task)}
        >
          {/* å±•å¼€ç®­å¤´ - ç‚¹å‡»æ­¤åŒºåŸŸä¸è¿›å…¥ä»»åŠ¡è¯¦æƒ… */}
          <div className="col-expand" onClick={(e) => e.stopPropagation()}>
            {hasSubtasks ? (
              <button 
                className="expand-btn"
                onClick={() => toggleExpand(task.id)}
              >
                {isExpanded ? <ChevronDown size={16} /> : <ChevronRight size={16} />}
              </button>
            ) : isSubtask ? (
              <span className="subtask-line">â””</span>
            ) : null}
          </div>

          {/* ========================================
              çŠ¶æ€æ ‡ç­¾ - æ ¸å¿ƒï¼šçŠ¶æ€å¿«é€Ÿåˆ‡æ¢åŠŸèƒ½
              ======================================== */}
          <div 
            className="col-status" 
            ref={isMenuOpen ? menuRef : null}
            onClick={(e) => e.stopPropagation()}
          >
            <button 
              className={`status-tag status-tag-${task.status}`}
              onClick={(e) => handleStatusClick(task.id, e)}
            >
              {renderStatusIcon(task.status, 12)}
              <span>{STATUS_CONFIG[task.status]?.label}</span>
            </button>

            {/* ä½¿ç”¨ Portal æ¸²æŸ“ä¸‹æ‹‰èœå•åˆ° bodyï¼Œé¿å…è¢«çˆ¶å…ƒç´ è£å‰ª */}
            {isMenuOpen && menuPosition && createPortal(
              <div 
                ref={menuRef}
                className="status-dropdown-portal"
                style={{
                  position: 'fixed',
                  top: menuPosition.top,
                  left: menuPosition.left,
                  zIndex: 99999,
                  background: '#ffffff',
                  border: '1px solid #e5e7eb',
                  borderRadius: '8px',
                  boxShadow: '0 10px 40px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05)',
                  padding: '6px',
                  minWidth: '130px',
                }}
              >
                {STATUS_ORDER.map(s => (
                  <button
                    key={s}
                    className={`dropdown-item ${task.status === s ? 'active' : ''}`}
                    onClick={(e) => { e.stopPropagation(); handleStatusSelect(task.id, s); }}
                    style={{ 
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      width: '100%',
                      padding: '8px 12px',
                      border: 'none',
                      background: task.status === s ? '#f3f4f6' : '#ffffff',
                      fontSize: '13px',
                      fontWeight: 500,
                      cursor: 'pointer',
                      borderRadius: '6px',
                      textAlign: 'left',
                    }}
                  >
                    {renderStatusIcon(s, 14)}
                    <span style={{ color: STATUS_CONFIG[s].color }}>{STATUS_CONFIG[s].label}</span>
                  </button>
                ))}
              </div>,
              document.body
            )}
          </div>

          {/* ä¼˜å…ˆçº§ */}
          <div className="col-priority">
            <div className="priority-bar" style={{ backgroundColor: priorityColor }} />
          </div>

          {/* æ ‡é¢˜ */}
          <div className="col-title">
            {isTitleSubtask && <span className="subtask-tag">å­ä»»åŠ¡</span>}
            <span className="title-text">{displayTitle}</span>
            {hasSubtasks && <span className="subtask-badge">{subtaskCount}</span>}
          </div>

          {/* åˆ›å»ºæ—¥æœŸ */}
          <div className="col-date">{formatDate(task.createdAt)}</div>

          {/* æˆªæ­¢æ—¥æœŸ */}
          <div className="col-due">
            {task.dueDate ? (
              <span className={new Date(task.dueDate) < new Date() && task.status !== 'done' ? 'overdue' : ''}>
                {new Date(task.dueDate).toLocaleDateString('zh-CN', { month: 'numeric', day: 'numeric' })}
              </span>
            ) : 'â€”'}
          </div>
        </div>

        {/* å­ä»»åŠ¡åˆ—è¡¨ */}
        {hasSubtasks && isExpanded && (
          <div className="subtasks-list">
            {subtasksByMain[task.id].map(sub => renderTaskRow(sub, true))}
          </div>
        )}
      </div>
    );
  };

  // ============================================
  // ç©ºçŠ¶æ€
  // ============================================
  if (mainTasks.length === 0) {
    return (
      <div className="task-list-empty">
        <div className="empty-box" />
        <p>æš‚æ— ä»»åŠ¡</p>
      </div>
    );
  }

  // ============================================
  // æ¸²æŸ“åˆ—è¡¨
  // ============================================
  return (
    <div className="task-list">
      {/* è¡¨å¤´ */}
      <div className="task-header">
        <div className="col-expand" />
        <div className="col-status">çŠ¶æ€</div>
        <div className="col-priority" />
        <div className="col-title">ä»»åŠ¡</div>
        <div className="col-date">åˆ›å»ºäº</div>
        <div className="col-due">æˆªæ­¢</div>
      </div>

      {/* ä»»åŠ¡åˆ—è¡¨ */}
      <div className="task-body">
        {mainTasks.map(task => renderTaskRow(task))}
      </div>
    </div>
  );
}
```

---

## TaskList.css å®Œæ•´ä»£ç 

```css
/* ============================================
   ä»»åŠ¡åˆ—è¡¨å®¹å™¨
   ============================================ */
.task-list {
  background: var(--bg-surface);
  border: 1px solid var(--border-subtle);
  border-radius: 8px;
  overflow: visible;
}

/* ============================================
   è¡¨å¤´
   ============================================ */
.task-header {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  background: var(--bg-surface-secondary);
  border-bottom: 1px solid var(--border-subtle);
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  gap: 12px;
}

/* ============================================
   åˆ—å®šä¹‰
   ============================================ */
.col-expand { width: 28px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
.col-status { width: 90px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; position: relative; }
.col-priority { width: 6px; flex-shrink: 0; }
.col-title { flex: 1; min-width: 0; display: flex; align-items: center; gap: 8px; }
.col-date { width: 70px; flex-shrink: 0; text-align: right; }
.col-due { width: 70px; flex-shrink: 0; text-align: right; }

.task-body {
  /* ç§»é™¤ overflow é™åˆ¶ï¼Œè®©çŠ¶æ€èœå•èƒ½æ­£å¸¸æ˜¾ç¤º */
}

/* ============================================
   ä»»åŠ¡é¡¹
   ============================================ */
.task-item-container {
  border-bottom: 1px solid var(--border-subtle);
}

.task-item-container:last-child {
  border-bottom: none;
}

.task-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  gap: 12px;
  cursor: pointer;
  transition: background 0.1s;
}

.task-item:hover {
  background: var(--bg-hover);
}

.task-item.completed {
  opacity: 0.55;
}

.task-item.is-subtask {
  padding-left: 28px;
  background: var(--bg-surface-secondary);
}

.task-item.is-subtask:hover {
  background: var(--bg-hover);
}

/* ============================================
   å±•å¼€æŒ‰é’®
   ============================================ */
.expand-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 22px;
  height: 22px;
  padding: 0;
  border: none;
  background: transparent;
  border-radius: 4px;
  color: var(--text-tertiary);
  cursor: pointer;
  transition: all 0.15s;
}

.expand-btn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.subtask-line {
  color: var(--border-default);
  font-size: 12px;
  margin-left: 4px;
}

/* ============================================
   çŠ¶æ€æ ‡ç­¾ - æ ¸å¿ƒæ ·å¼
   ============================================ */
.status-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border: none;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.15s;
  white-space: nowrap;
}

.status-tag:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

/* çŠ¶æ€æ ‡ç­¾é¢œè‰² */
.status-tag-todo {
  background: rgba(156, 163, 175, 0.15);
  color: #6b7280;
}

.status-tag-in_progress {
  background: rgba(59, 130, 246, 0.15);
  color: #2563eb;
}

.status-tag-review {
  background: rgba(245, 158, 11, 0.15);
  color: #d97706;
}

.status-tag-blocked {
  background: rgba(239, 68, 68, 0.15);
  color: #dc2626;
}

.status-tag-done {
  background: rgba(34, 197, 94, 0.15);
  color: #16a34a;
}

/* ============================================
   çŠ¶æ€å›¾æ ‡
   ============================================ */
.status-tag .status-icon {
  width: 12px;
  height: 12px;
  border-width: 1.5px;
}

.status-tag .status-icon.in-progress .dot {
  width: 5px;
  height: 5px;
}

.status-tag .status-icon.review .ring {
  width: 5px;
  height: 5px;
  border-width: 1.5px;
}

.status-icon {
  width: 18px;
  height: 18px;
  border: 2px solid var(--border-default);
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
}

.status-icon.todo {
  background: transparent;
}

.status-icon.done {
  border-radius: 4px;
}

.status-icon.in-progress .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
}

.status-icon.review .ring {
  width: 8px;
  height: 8px;
  border: 2px solid;
  border-radius: 50%;
}

/* ============================================
   çŠ¶æ€ä¸‹æ‹‰èœå•ï¼ˆå¤‡ç”¨æ ·å¼ï¼Œå®é™…ä½¿ç”¨ Portal å†…è”æ ·å¼ï¼‰
   ============================================ */
.status-dropdown {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  z-index: 9999;
  min-width: 130px;
  background: #ffffff;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(0, 0, 0, 0.05);
  padding: 6px;
  animation: dropdown-in 0.12s ease-out;
  isolation: isolate;
}

/* ä½¿ç”¨ä¼ªå…ƒç´ åˆ›å»ºå®Œå…¨ä¸é€æ˜çš„èƒŒæ™¯å±‚ */
.status-dropdown::before {
  content: '';
  position: absolute;
  inset: 0;
  background: #ffffff;
  border-radius: 8px;
  z-index: -1;
}

/* æ·±è‰²æ¨¡å¼ä¸‹çš„ä¸‹æ‹‰èœå• */
[data-theme="dark"] .status-dropdown {
  background: #1f2937;
  border-color: #4b5563;
}

[data-theme="dark"] .status-dropdown::before {
  background: #1f2937;
}

@keyframes dropdown-in {
  from { 
    opacity: 0; 
    transform: translateX(-50%) translateY(-4px); 
  }
  to { 
    opacity: 1; 
    transform: translateX(-50%) translateY(0); 
  }
}

/* ============================================
   ä¸‹æ‹‰èœå•é€‰é¡¹
   ============================================ */
.dropdown-item {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 8px 12px;
  border: none;
  background-color: #ffffff;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  border-radius: 6px;
  transition: background-color 0.1s;
  text-align: left;
  white-space: nowrap;
  color: #374151;
}

[data-theme="dark"] .dropdown-item {
  background-color: #1f2937;
  color: #e5e7eb;
}

.dropdown-item:hover {
  background-color: #f3f4f6 !important;
}

[data-theme="dark"] .dropdown-item:hover {
  background-color: #374151 !important;
}

.dropdown-item.active {
  background-color: #ede9fe !important;
}

[data-theme="dark"] .dropdown-item.active {
  background-color: #312e81 !important;
}

.dropdown-item .status-icon {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

.dropdown-item .status-icon.in-progress .dot {
  width: 6px;
  height: 6px;
}

.dropdown-item .status-icon.review .ring {
  width: 6px;
  height: 6px;
}

/* ============================================
   ä¼˜å…ˆçº§æ¡
   ============================================ */
.priority-bar {
  width: 4px;
  height: 18px;
  border-radius: 2px;
}

/* ============================================
   å­ä»»åŠ¡æ ‡ç­¾
   ============================================ */
.subtask-tag {
  display: inline-flex;
  align-items: center;
  padding: 2px 6px;
  background: var(--color-primary-alpha-15);
  color: var(--color-primary);
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  flex-shrink: 0;
}

/* ============================================
   æ ‡é¢˜æ–‡æœ¬
   ============================================ */
.title-text {
  font-size: 14px;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.task-item.completed .title-text {
  text-decoration: line-through;
  color: var(--text-tertiary);
}

/* ============================================
   å­ä»»åŠ¡æ•°é‡å¾½ç« 
   ============================================ */
.subtask-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  background: var(--bg-surface-secondary);
  border: 1px solid var(--border-subtle);
  border-radius: 9px;
  font-size: 11px;
  font-weight: 600;
  color: var(--text-tertiary);
  flex-shrink: 0;
}

/* ============================================
   æ—¥æœŸåˆ—
   ============================================ */
.col-date,
.col-due {
  font-size: 12px;
  color: var(--text-tertiary);
}

.col-due .overdue {
  color: #ef4444;
  font-weight: 500;
}

/* ============================================
   å­ä»»åŠ¡åˆ—è¡¨
   ============================================ */
.subtasks-list {
  border-top: 1px dashed var(--border-subtle);
  background: var(--bg-surface-secondary);
}

.subtasks-list .task-item-container {
  border-bottom: 1px dashed var(--border-subtle);
}

.subtasks-list .task-item-container:last-child {
  border-bottom: none;
}

/* ============================================
   ç©ºçŠ¶æ€
   ============================================ */
.task-list-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 60px 20px;
  color: var(--text-tertiary);
  gap: 12px;
}

.empty-box {
  width: 32px;
  height: 32px;
  border: 2px solid var(--border-default);
  border-radius: 6px;
}

.task-list-empty p {
  font-size: 14px;
  margin: 0;
}

/* ============================================
   å“åº”å¼è®¾è®¡
   ============================================ */
@media (max-width: 768px) {
  .col-date,
  .col-due {
    display: none;
  }
  
  .task-item {
    padding: 10px 12px;
  }
  
  .task-item.is-subtask {
    padding-left: 24px;
  }
  
  .task-header {
    padding: 8px 12px;
  }
}
```

---

## ä½¿ç”¨æ–¹æ³•

### 1. åœ¨çˆ¶ç»„ä»¶ä¸­è°ƒç”¨

```tsx
import TaskList from './components/TaskList';
import { taskService } from './services/task';

function ProjectDetail() {
  const [tasks, setTasks] = useState<Task[]>([]);
  
  // å¤„ç†ä»»åŠ¡ç‚¹å‡»
  const handleTaskClick = (task: Task) => {
    navigate(`/tasks/${task.id}`);
  };
  
  // å¤„ç†çŠ¶æ€åˆ‡æ¢
  const handleStatusChange = async (taskId: string, newStatus: string) => {
    try {
      await taskService.updateTask(taskId, { status: newStatus });
      // åˆ·æ–°ä»»åŠ¡åˆ—è¡¨
      loadTasks();
    } catch (err) {
      console.error('çŠ¶æ€æ›´æ–°å¤±è´¥:', err);
    }
  };
  
  return (
    <TaskList 
      tasks={tasks}
      onTaskClick={handleTaskClick}
      onStatusChange={handleStatusChange}
    />
  );
}
```

### 2. Task ç±»å‹å®šä¹‰

```tsx
interface Task {
  id: string;
  title: string;
  status: string;       // 'todo' | 'in_progress' | 'review' | 'done'
  priority: string;     // 'urgent' | 'high' | 'medium' | 'low'
  createdAt: string;
  dueDate?: string | null;
  parentId?: string | null;
}
```

---

## æ ¸å¿ƒå®ç°è¦ç‚¹

### 1. React Portal

ä½¿ç”¨ `createPortal` å°†ä¸‹æ‹‰èœå•æ¸²æŸ“åˆ° `document.body`ï¼Œé¿å…è¢«çˆ¶å…ƒç´ çš„ `overflow: hidden` è£å‰ªã€‚

```tsx
{createPortal(
  <div className="status-dropdown-portal" style={{ position: 'fixed', ... }}>
    {/* èœå•å†…å®¹ */}
  </div>,
  document.body
)}
```

### 2. åŠ¨æ€å®šä½

æ ¹æ®ç‚¹å‡»æŒ‰é’®çš„ä½ç½®è®¡ç®—ä¸‹æ‹‰èœå•çš„ç»å¯¹å®šä½ï¼š

```tsx
const rect = (e.currentTarget as HTMLElement).getBoundingClientRect();
setMenuPosition({ top: rect.bottom + 4, left: rect.left });
```

### 3. ç‚¹å‡»å¤–éƒ¨å…³é—­

ä½¿ç”¨ `useEffect` ç›‘å¬å…¨å±€ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»èœå•å¤–éƒ¨æ—¶è‡ªåŠ¨å…³é—­ï¼š

```tsx
useEffect(() => {
  const handleClickOutside = (e: MouseEvent) => {
    if (!target.closest('.status-dropdown-portal')) {
      setOpenMenuId(null);
    }
  };
  document.addEventListener('click', handleClickOutside);
  return () => document.removeEventListener('click', handleClickOutside);
}, [openMenuId]);
```

### 4. äº‹ä»¶é˜»æ­¢å†’æ³¡

çŠ¶æ€æŒ‰é’®å’Œä¸‹æ‹‰èœå•çš„ç‚¹å‡»äº‹ä»¶éœ€è¦é˜»æ­¢å†’æ³¡ï¼Œé¿å…è§¦å‘ä»»åŠ¡è¡Œçš„ç‚¹å‡»äº‹ä»¶ï¼š

```tsx
onClick={(e) => e.stopPropagation()}
```

---

## æ•ˆæœé¢„è§ˆ

| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² |
|------|------|------|
| å¾…åŠ | â¬œ ç©ºç™½æ–¹æ¡† | ç°è‰² #9ca3af |
| è¿›è¡Œä¸­ | ğŸ”µ è“è‰²åœ†ç‚¹ | è“è‰² #3b82f6 |
| å®¡æ ¸ä¸­ | ğŸŸ¡ é»„è‰²åœ†ç¯ | æ©™è‰² #f59e0b |
| å·²å®Œæˆ | âœ… ç»¿è‰²å‹¾é€‰ | ç»¿è‰² #22c55e |

---

*æ–‡æ¡£ç”Ÿæˆæ—¶é—´: 2025å¹´12æœˆ13æ—¥*

